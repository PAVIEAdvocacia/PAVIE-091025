---
import { getCollection, type CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const all = await getCollection('posts');
  return all.map((entry) => ({ params: { slug: entry.slug }, props: { entry } }));
}

const { entry } = Astro.props as { entry: CollectionEntry<'posts'> };
const data = entry.data as any;
const pub = data.pubDate ?? data.date;
const img = data.heroImage ?? data.featuredImage ?? null;
const schemaType = data.seo?.schema_type || (data.type === 'noticia' ? 'NewsArticle' : data.type === 'guia' ? 'HowTo' : 'Article');
---
<html lang={data.lang || 'pt-BR'}>
  <head>
    <meta charset="utf-8" />
    <title>{data.title} | PAVIE Advocacia</title>
    <meta name="description" content={data.description || ''} />
    <link rel="canonical" href={`https://pavieadvocacia.com.br/blog/${entry.slug}/`} />
    <script type="application/ld+json">
      {JSON.stringify({
        '@context': 'https://schema.org',
        '@type': schemaType,
        headline: data.title,
        datePublished: pub,
        dateModified: data.updated || pub,
        author: [{ '@type':'Person', name: data.author || 'Fabio Mathias Pavie' }]
      })}
    </script>
  </head>
  <body>
    <article>
      <h1>{data.title}</h1>
      {pub && <p><small>{new Date(pub).toLocaleDateString('pt-BR')}</small></p>}
      {img && <img src={img} alt="" />}
      <div set:html={await Astro.markdown(entry.body)} />
    </article>
  </body>
</html>
