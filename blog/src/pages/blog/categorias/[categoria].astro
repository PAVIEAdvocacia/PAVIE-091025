---
import Layout from "../../../components/Layout.astro";
import Breadcrumbs from "../../../components/Breadcrumbs.astro";
import PostCard from "../../../components/PostCard.astro";
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const all = await getCollection('blog');
  const cats = new Set(all.flatMap(p => p.data.categorias || []));
  return Array.from(cats).map(c => ({ params: { categoria: c } }));
}

const { categoria } = Astro.params;
const posts = (await getCollection('blog')).filter(p => (p.data.categorias || []).includes(categoria)).sort((a,b)=> b.data.date.valueOf() - a.data.date.valueOf());
---
<Layout title={`Categoria: ${categoria} — Blog PAVIE`} description={`Artigos da categoria ${categoria}.`}>
  <Breadcrumbs trail={[{href:"/",label:"Início"},{href:"/blog/",label:"Blog"},{label:`Categoria: ${categoria}`}]}/>
  <h1>Categoria: {categoria}</h1>
  <div class="grid grid-3">
    {posts.map(p => <PostCard post={p} />)}
  </div>
</Layout>
