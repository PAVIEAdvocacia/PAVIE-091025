---
import Layout from "../../../components/Layout.astro";
import Breadcrumbs from "../../../components/Breadcrumbs.astro";
import PostCard from "../../../components/PostCard.astro";
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const all = await getCollection('blog');
  const tags = new Set(all.flatMap(p => p.data.tags || []));
  return Array.from(tags).map(t => ({ params: { tag: t } }));
}

const { tag } = Astro.params;
const posts = (await getCollection('blog')).filter(p => (p.data.tags || []).includes(tag)).sort((a,b)=> b.data.date.valueOf() - a.data.date.valueOf());
---
<Layout title={`Tag: ${tag} — Blog PAVIE`} description={`Artigos marcados com ${tag}.`}>
  <Breadcrumbs trail={[{href:"/",label:"Início"},{href:"/blog/",label:"Blog"},{label:`Tag: ${tag}`}]}/>
  <h1>Tag: {tag}</h1>
  <div class="grid grid-3">
    {posts.map(p => <PostCard post={p} />)}
  </div>
</Layout>
