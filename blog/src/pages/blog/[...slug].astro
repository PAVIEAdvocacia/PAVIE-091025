---
import { type CollectionEntry, getCollection, render } from 'astro:content';
import BlogPost from '../../layouts/BlogPost.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: post,
  }));
}

type Props = CollectionEntry<'blog'>;

// Post recebido do getStaticPaths
const post: Props = Astro.props;

// Renderiza o conteúdo MD/MDX
const { Content } = await render(post);

// Garante que campos opcionais NUNCA serão undefined
const safeData = {
  ...post.data,
  layoutType: post.data?.layoutType ?? 'article',
  title: post.data?.title ?? 'Post sem título',
  description: post.data?.description ?? '',
  pubDate: post.data?.pubDate ?? new Date().toISOString(),
  updatedDate: post.data?.updatedDate ?? post.data?.pubDate ?? new Date().toISOString(),
};
---

<BlogPost {...safeData}>
  <Content />
</BlogPost>
